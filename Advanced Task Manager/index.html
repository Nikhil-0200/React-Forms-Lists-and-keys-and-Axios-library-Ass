<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Template</title>
    <style>
      .userDiv {
        border: 2px solid black;
        width: 50%;
        margin: 10px 0px;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <script src="https://www.unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script src="https://www.unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script type="text/babel">
    let { useState, useEffect } = React;

    let ShowData = () => {
      let [data, setData] = useState([]);
      let [originalData, setOriginalData] = useState([]);

      useEffect(() => {
        getData();
      }, []);

      async function getData() {
        try {
          let res = await axios({
            method: "GET",
            baseURL: "http://localhost:3000/todos",
          });
          setData(res.data);
          setOriginalData(res.data);
        } catch (error) {
          console.log("error");
        }
      }

      let handleDelete = async (id) => {
        try {
          let res = await axios({
            method: "DELETE",
            baseURL: `http://localhost:3000/todos/${id}`,
          });
        } catch (error) {
          console.log("error");
        }
      };

      let getAllData = () => {
        getData();
      };

      let showIncompleteTasks = () => {
        setData((preValue) => preValue.filter((ele) => ele.status !== true));
      };

      let handleFilter = (e) => {
        setData(originalData.filter((ele) => ele.assignee === e.target.value));
      };

      return (
        <div>
          <br />
          <br />
          <button onClick={getAllData}>Get All Tasks</button>
          <button onClick={showIncompleteTasks}>showIncompleteTasks</button>

          <br />
          <br />
          <br />

          <label>Filter Data By Assignee: </label>
          <select onChange={handleFilter}>
            <option value="Nikhil">Nikhil</option>
            <option value="Karan">Karan</option>
            <option value="Aman">Aman</option>
          </select>

          <br />
          <br />

          {data.map((ele, index) => (
            <div className="userDiv" key={index}>
              <p>{ele.id}.</p>
              <p>{`Title: ${ele.title}`}</p>
              <p>{`Status: ${ele.status ? "Yes" : "No"}`}</p>
              <p>{`Task Assigned To: ${ele.assignee}`}</p>
              <button onClick={() => handleDelete(ele.id)}>üóëÔ∏è</button>
            </div>
          ))}
        </div>
      );
    };

    let App = () => {
      let [array, setArray] = useState([]);
      let [task, setTask] = useState({
        title: "",
        isCompleted: false,
        assignee: "Nikhil",
      });

      async function fetchData() {
        try {
          await Promise.all(
            array.map(async (ele) => {
              let res = await axios({
                method: "POST",
                baseURL: `http://localhost:3000/todos`,
                data: {
                  title: ele.title,
                  status: ele.isCompleted,
                  assignee: ele.assignee,
                },
              });
            })
          );
        } catch (error) {
          console.log("error");
        }
      }

      function handleSubmit(event) {
        event.preventDefault();
        let giveId = {
          ...task,
          id: Date.now(),
        };
        let storeData = [...array, giveId];
        setArray(storeData);
      }

      function handleChange(event) {
        const value =
          event.target.type === "checkbox"
            ? event.target.checked
            : event.target.value;
        let newData = { ...task, [event.target.name]: value };
        setTask(newData);
      }

      useEffect(() => {
        fetchData();
      }, [array]);

      return (
        <div>
          <form onSubmit={handleSubmit}>
            <label
              style={{
                fontSize: "xx-large",
                fontWeight: "bold",
                lineHeight: "100px",
              }}
            >
              Task Manager
            </label>
            <div>
              <div>
                <label>Add Title: </label>
                <input
                  name="title"
                  type="text"
                  placeholder="Enter Title"
                  value={task.title}
                  onChange={handleChange}
                />
              </div>

              <div>
                <label>Status: </label>
                <input
                  name="isCompleted"
                  type="checkbox"
                  checked={task.isCompleted}
                  onChange={handleChange}
                />
              </div>
              <label>Assigned: </label>
              <select
                value={task.assignee}
                onChange={handleChange}
                name="assignee"
              >
                <option value="Nikhil">Nikhil</option>
                <option value="Karan">Karan</option>
                <option value="Aman">Aman</option>
              </select>
            </div>

            <button type="submit">Submit</button>
          </form>

          <ShowData />
        </div>
      );
    };

    let root = document.getElementById("root");
    let reactRoot = ReactDOM.createRoot(root);
    reactRoot.render(<App />);
  </script>
</html>
